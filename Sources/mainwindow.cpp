#include "mainwindow.h"
#include "ui_mainwindow.h"
#include "validate-credit-card.h"

MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent)
    , ui(new Ui::MainWindow)
{
    ui->setupUi(this);
}

MainWindow::~MainWindow()
{
    delete ui;
}

// When the push button is clicked, validate the credit card number
// using Luhn's algorithm and check if the brand is known
void MainWindow::on_pushButton_clicked()
{
    std::string str = ui->lineEdit->text().toStdString();
    int len = str.length();
    bool validNum = false;
    bool validBrand = false;
    ui->brandtxt_label->setText("Brand:");

    if(str[0] == '3' && (str[1] == '4' || str[1] == '7') && len == 15){
        // American Express
        validBrand = true;
        ui->brandsvg_label->setText("<img src='data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjQwIiB2aWV3Qm94PSIwIDAgNjAgNDAiIHdpZHRoPSI2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgPHBhdGggZmlsbD0iIzAxNmZkMCIgaGVpZ2h0PSIxNiIgcng9IjIiIHdpZHRoPSIyNCIgZD0iTTUgMEg1NUE1IDUgMCAwIDEgNjAgNVYzNUE1IDUgMCAwIDEgNTUgNDBINUE1IDUgMCAwIDEgMCAzNVY1QTUgNSAwIDAgMSA1IDB6Ii8+CiAgICA8cGF0aCBkPSJNMzQuNDEgMzMuNDg1VjE5LjIzbDI1LjM3IDAuMDI1djMuOTM1bC0yLjkzMyAzLjEzNSAyLjkzMyAzLjE2MnY0LjAyaC00LjY4M2wtMi40ODcgLTIuNzQ1IC0yLjQ3IDIuNzU1eiIgZmlsbD0iI2ZmZmZmZSIvPgogICAgPHBhdGggZD0iTTM2LjEwNSAzMS45MjJ2LTExLjEyNWg5LjQzdjIuNTY1aC02LjM3NXYxLjczN2g2LjIyNXYyLjUyaC02LjIyNXYxLjcxaDYuMzc1djIuNTkyeiIgZmlsbD0iIzAxNmZkMCIvPgogICAgPHBhdGggZD0ibTQ1LjQ4NyAzMS45MjIgNS4yMiAtNS41NjcgLTUuMjIgLTUuNTU1aDQuMDRsMy4xODggMy41MjUgMy4yIC0zLjUyNWgzLjg2NXYwLjA4OGwtNS4xMDcgNS40NjcgNS4xMDcgNS40MXYwLjE1OEg1NS44NzVsLTMuMjQ1IC0zLjU2IC0zLjIxMiAzLjU2eiIgZmlsbD0iIzAxNmZkMCIvPgogICAgPHBhdGggZD0iTTM1LjU5MyA2LjU4aDYuMTE1bDIuMTUgNC44NzV2LTQuODc1aDcuNTVsMS4zIDMuNjU1IDEuMzA4IC0zLjY1NWg1Ljc2NXYxNC4yNTJIMjkuMzEzeiIgZmlsbD0iI2ZmZmZmZSIvPgogICAgPGcgZmlsbD0iIzAxNmZkMCI+CiAgICAgIDxwYXRoIGQ9Im0zNi43NSA4LjEyNyAtNC45MzUgMTEuMTE1aDMuMzg1bDAuOTMyIC0yLjIyNWg1LjA0NWwwLjkzIDIuMjI1aDMuNDY4TDQwLjY2MyA4LjEyNXptMC40MjUgNi4zOTUgMS40OCAtMy41MzggMS40OCAzLjUzOHoiLz4KICAgICAgPHBhdGggZD0iTTQ1LjUzIDE5LjI0VjguMTI1bDQuNzU4IDAuMDE1IDIuNDUgNi44MzMgMi40NjIgLTYuODVoNC41OHYxMS4xMTVsLTIuOTQ4IDAuMDI1VjExLjYzMkw1NC4wNSAxOS4yNGgtMi42ODhsLTIuODQgLTcuNjM1djcuNjM1eiIvPgogICAgPC9nPgogIDwvZz4KPC9zdmc+Cg=='/>");
    }
    else if(str[0] == '4' && (len == 13 || len == 16)){
        //Visa
        validBrand = true;
        ui->brandsvg_label->setText("<img src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA2MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIj48cGF0aCBzdHJva2Utb3BhY2l0eT0iLjIiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxLjI1IiBmaWxsPSIjRkZGIiB4PSIuMjUiIHk9Ii4yNSIgd2lkdGg9IjIzLjUiIGhlaWdodD0iMTUuNSIgcng9IjIiIGQ9Ik01LjYyNSAwLjYyNUg1NC4zNzVBNSA1IDAgMCAxIDU5LjM3NSA1LjYyNVYzNC4zNzVBNSA1IDAgMCAxIDU0LjM3NSAzOS4zNzVINS42MjVBNSA1IDAgMCAxIDAuNjI1IDM0LjM3NVY1LjYyNUE1IDUgMCAwIDEgNS42MjUgMC42MjV6Ii8+PHBhdGggZD0iTTYuOTcgMTQuNzg1QTE4LjAwMiAxOC4wMDIgMCAwIDAgMi41IDEzLjA5M2wwLjA3IC0wLjMxM2g2Ljg0M2MwLjkyNyAwLjAzMyAxLjY4IDAuMzEzIDEuOTI1IDEuMjk4bDEuNDg3IDcuMDkgMC40NTUgMi4xMzUgNC4xNjUgLTEwLjUyNWg0LjQ5N2wtNi42ODUgMTUuNDE4SDEwLjc2TDYuOTcgMTQuNzg1Wm0xOC4yOCAxMy40MjVIMjAuOTk3bDIuNjYgLTE1LjQzaDQuMjVMMjUuMjUgMjguMjFabTE1LjQxOCAtMTUuMDUzIC0wLjU4IDMuMzMzIC0wLjM4MyAtMC4xNjVhNy42MzUgNy42MzUgMCAwIDAgLTMuMTcgLTAuNTljLTEuNjc4IDAgLTIuNDMgMC42NzMgLTIuNDUgMS4zMjggMCAwLjcyNSAwLjkxMiAxLjIgMi40IDEuOTA1IDIuNDUgMS4xIDMuNTg4IDIuNDQ3IDMuNTcgNC4yMDMgLTAuMDM1IDMuMiAtMi45NCA1LjI3IC03LjQgNS4yNyAtMS45MSAtMC4wMTggLTMuNzUgLTAuMzk1IC00Ljc0NSAtMC44MmwwLjU5NSAtMy40NjUgMC41NiAwLjI0N2MxLjM4MyAwLjU3NSAyLjI5MiAwLjgyIDMuOTkgMC44MiAxLjIyNSAwIDIuNTM3IC0wLjQ3NSAyLjU1NSAtMS41MSAwIC0wLjY3NSAtMC41NiAtMS4xNjUgLTIuMjA1IC0xLjkyMyAtMS42MSAtMC43MzcgLTMuNzYyIC0xLjk3IC0zLjcyOCAtNC4xODVDMjkuNjk1IDE0LjYgMzIuNjUgMTIuNSAzNi44NSAxMi41YzEuNjQ1IDAgMi45NzUgMC4zNDUgMy44MTUgMC42NTdabTUuNjUgOS41ODVoMy41MzhjLTAuMTc1IC0wLjc3IC0wLjk4IC00LjQ2NSAtMC45OCAtNC40NjVsLTAuMyAtMS4zMjhjLTAuMjA4IDAuNTc1IC0wLjU3NSAxLjUxIC0wLjU1NyAxLjQ3NWwtMS43IDQuMzE3Wm01LjI1IC05Ljk2M0w1NSAyOC4yMWgtMy45MzhzLTAuMzg1IC0xLjc3NSAtMC41MDggLTIuMzE1aC01LjQ2bC0wLjg5MiAyLjMxNWgtNC40NjJsNi4zMTggLTE0LjE1YzAuNDM4IC0xIDEuMjA4IC0xLjI4IDIuMjIzIC0xLjI4aDMuMjlaIiBmaWxsPSIjMTQzNENCIi8+PC9nPjwvc3ZnPg=='/>");
    }
    else if(str[0] == '5' && (str[1] == '1' || str[1] == '2' || str[1] == '3'
                               || str[1] == '4' || str[1] == '5') && len == 16){
        // MasterCard
        validBrand = true;
        ui->brandsvg_label->setText("<img src='data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjQwIiB2aWV3Qm94PSIwIDAgNjAgNDAiIHdpZHRoPSI2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgPHBhdGggZmlsbD0iIzI1MjUyNSIgaGVpZ2h0PSIxNiIgcng9IjIiIHdpZHRoPSIyNCIgZD0iTTUgMEg1NUE1IDUgMCAwIDEgNjAgNVYzNUE1IDUgMCAwIDEgNTUgNDBINUE1IDUgMCAwIDEgMCAzNVY1QTUgNSAwIDAgMSA1IDB6Ii8+CiAgICA8cGF0aCBjeD0iOSIgY3k9IjgiIGZpbGw9IiNlYjAwMWIiIHI9IjUiIGQ9Ik0zNSAyMEExMi41IDEyLjUgMCAwIDEgMjIuNSAzMi41QTEyLjUgMTIuNSAwIDAgMSAxMCAyMEExMi41IDEyLjUgMCAwIDEgMzUgMjB6Ii8+CiAgICA8cGF0aCBjeD0iMTUiIGN5PSI4IiBmaWxsPSIjZjc5ZTFiIiByPSI1IiBkPSJNNTAgMjBBMTIuNSAxMi41IDAgMCAxIDM3LjUgMzIuNUExMi41IDEyLjUgMCAwIDEgMjUgMjBBMTIuNSAxMi41IDAgMCAxIDUwIDIweiIvPgogICAgPHBhdGggZD0iTTMwIDEwYzMuMDM1IDIuMjggNSA1LjkxIDUgMTBzLTEuOTY1IDcuNzIgLTUgMTBjLTMuMDM1IC0yLjI4IC01IC01LjkxIC01IC0xMHMxLjk2NSAtNy43MiA1IC0xMHoiIGZpbGw9IiNmZjVmMDAiLz4KICA8L2c+Cjwvc3ZnPg=='/>");
    }
    else if(str.substr(0,2) == "35" && len == 16){
        // JCB
        validBrand = true;
        ui->brandsvg_label->setText("<img src='data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjQwIiB2aWV3Qm94PSIwIDAgNjAgNDAiIHdpZHRoPSI2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBmaWxsPSJub25lIj4KICAgIDxwYXRoIGQ9Ik0wLjUzNSA0MGgxMS43ODZjMi42ODIgMCA1Ljg5NiAtMy4xMTcgNS44OTYgLTUuNTY0VjBoLTExLjc5MUMzLjc0NiAwIDAuNTM1IDMuMTE3IDAuNTM1IDguMzQ4eiIgZmlsbD0iIzA0N2FiMSIvPgogICAgPHBhdGggZD0iTTcuMjI2IDI4LjIxNmEyNS40ODcgMjUuNDg3IDAgMCAxIC02LjY5MSAtMC44OVYyNC4yNjFhMTEuOTc5IDExLjk3OSAwIDAgMCA1LjU5OCAxLjYxNWMyLjI3IDAgMy41MzcgLTEuNTAzIDMuNTM3IC0zLjU2MVYxMy45MTJoNS41OTh2OC40MDVjMCAzLjI4MiAtMS44MjYgNS44OTggLTguMDQ1IDUuODk4eiIgZmlsbD0iI2ZmZiIvPgogICAgPHBhdGggZD0iTTIxLjE2MiA0MGgxMS43ODNjMi42ODIgMCA1Ljg5NiAtMy4xMTcgNS44OTYgLTUuNTY0VjBIMjcuMDUyQzI0LjM3MyAwIDIxLjE1NyAzLjExNyAyMS4xNTcgOC4zNDh6IiBmaWxsPSIjZDQyZDA2Ii8+CiAgICA8cGF0aCBkPSJNMjEuMTYyIDE1Ljg2MWMxLjcwOSAtMS41NTcgNC42NTQgLTIuNTMgOS40MjggLTIuMzA5IDIuNTkzIDAuMTEgNS4zMDMgMC44MzUgNS4zMDMgMC44MzV2My4wODlhMTIuNDgzIDEyLjQ4MyAwIDAgMCAtNS4wOTcgLTEuNTg2Yy0zLjYyNiAtMC4zMDggLTUuODMzIDEuNjEyIC01LjgzMyA0Ljk4czIuMjEgNS4yODggNS44MzMgNS4wMDlhMTIuNjYgMTIuNjYgMCAwIDAgNS4wOTcgLTEuNjE1djMuMDYzcy0yLjcxMyAwLjc1MSAtNS4zMDMgMC44NjFjLTQuNzc0IDAuMjI0IC03LjcyMiAtMC43NTEgLTkuNDI4IC0yLjMwOXoiIGZpbGw9IiNmZmYiLz4KICAgIDxwYXRoIGQ9Ik00MS43ODYgNDBoMTEuNzg2YzIuNjgyIDAgNS44OTMgLTMuMTE3IDUuODkzIC01LjU2NFYwaC0xMS43ODZjLTIuNjgyIDAgLTUuODk2IDMuMTE3IC01Ljg5NiA4LjM0OHoiIGZpbGw9IiM2N2I2MzciLz4KICAgIDxwYXRoIGQ9Ik01Ni41MTcgMjQuMjA5YzAgMi4yMjUgLTEuODI2IDMuNjE4IC00LjI3MyAzLjYxOGgtMTAuNDYxVjEzLjkxMmg5LjUxOWwwLjY3OCAwLjAyOWMyLjE1IDAuMTEyIDMuNzQxIDEuMzA3IDMuNzQxIDMuMzY1IDAgMS42MTcgLTEuMDkgMy4wMDggLTMuMDYzIDMuMzM5djAuMDg2YzIuMTc4IDAuMTM4IDMuODYxIDEuNDQ1IDMuODYxIDMuNDc3em0tNy41MTMgLTguMDk3YTIuODM2IDIuODM2IDAgMCAwIC0wLjM4MyAtMC4wMjZoLTMuNTM1djMuNTAzaDMuOTE4YTEuNzQgMS43NCAwIDAgMCAxLjM1NyAtMS43NTNjMCAtMC45NDQgLTAuNjIxIC0xLjU4NiAtMS4zNTcgLTEuNzI0em0wLjQ0MyA1LjY3N2EyLjY4MiAyLjY4MiAwIDAgMCAtMC40NzIgLTAuMDI2aC0zLjg5djMuODA5aDMuODg3bDAuNDcyIC0wLjA1MmMwLjczOCAtMC4xNyAxLjM1NyAtMC44OTIgMS4zNTcgLTEuODY1IDAgLTAuOTc2IC0wLjU5IC0xLjY3IC0xLjM1NyAtMS44NjV6IiBmaWxsPSIjZmZmIi8+CiAgPC9nPgo8L3N2Zz4K/>");
    }
    else if((str.substr(0,4) == "6011" || str.substr(0,3) == "622" ||
              str.substr(0,2) == "64" || str.substr(0,2) == "65") && len == 16){
        // Discover
        validBrand = true;
        ui->brandsvg_label->setText("<img src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA2MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZyBmaWxsPSJub25lIj4KICAgIDxwYXRoIGQ9Ik01NC45OTIgMzkuMzc1SDU1YzIuMzg3IDAuMDIgNC4zNSAtMS45MzMgNC4zNzcgLTQuMzY1VjUuMDE1YTQuNDczIDQuNDczIDAgMCAwIC0xLjMgLTMuMTI1QTQuMyA0LjMgMCAwIDAgNTQuOTkyIDAuNjI1SDUuMDAyQTQuMjk1IDQuMjk1IDAgMCAwIDEuOTI1IDEuODkzYy0wLjgyNSAwLjgyNSAtMS4yOTIgMS45NDggLTEuMzAyIDMuMTE4djI5Ljk3NWMwLjAxIDEuMTc1IDAuNDc4IDIuMyAxLjMgMy4xMjUgMC44MjMgMC44MiAxLjkyNyAxLjI3NSAzLjA4MyAxLjI2NWg0OS45ODVabTAgMS4yNWgtMC4wMDVaIiBzdHJva2Utb3BhY2l0eT0iLjIiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxLjI1IiBmaWxsPSIjRkZGIi8+CiAgICA8cGF0aCBkPSJNMzEuNTMgNDBoMjMuNDYyQTQuOTY1IDQuOTY1IDAgMCAwIDYwIDM1LjA3NXYtNS44OTVBOTYuODUgOTYuODUgMCAwIDEgMzEuNTMgNDBaIiBmaWxsPSIjRjI3NzEyIi8+CiAgICA8cGF0aCBkPSJNNTcuOTMgMjMuMjRoLTIuMTNsLTIuNCAtMy4xNjVoLTAuMjI3djMuMTY1aC0xLjczN1YxNS4zOEg1NGMyLjAwOCAwIDMuMTY1IDAuODI1IDMuMTY1IDIuMzE3IDAgMS4yMiAtMC43MjUgMi4wMDUgLTIuMDI1IDIuMjU1bDIuNzkgMy4yODdabS0yLjU2NSAtNS40ODJjMCAtMC43NjUgLTAuNTggLTEuMTU3IC0xLjY1NSAtMS4xNTdoLTAuNTM3djIuMzhoMC40OThjMS4xMTUgMCAxLjY5NSAtMC40MTUgMS42OTUgLTEuMjIyWm0tMTAuMDEyIC0yLjM3N2g0LjkyNXYxLjMyNWgtMy4xODh2MS43NTdoMy4wNjN2MS4zNDVoLTMuMDYzdjIuMTNoMy4xODV2MS4zMjVoLTQuOTI1VjE1LjM4Wm0tNS41ODcgOC4wNjdMMzYgMTUuMzU3aDEuOTAzbDIuMzggNS4yOTggMi40IC01LjI5OGgxLjg2M0w0MC43MzggMjMuNDVoLTAuOTczWm0tMTUuNzQ1IC0wLjAyYy0yLjY0NyAwIC00LjcxOCAtMS44IC00LjcxOCAtNC4xMzggMCAtMi4yNzUgMi4xMTIgLTQuMTE3IDQuNzYgLTQuMTE3IDAuNzQ1IDAgMS4zNjUgMC4xNDUgMi4xMyAwLjQ3NXYxLjgyM2EzLjEwMyAzLjEwMyAwIDAgMCAtMi4xNzIgLTAuODljLTEuNjU1IDAgLTIuOTE3IDEuMiAtMi45MTcgMi43MSAwIDEuNTkzIDEuMjQyIDIuNzMgMyAyLjczIDAuNzg3IDAgMS4zODggLTAuMjUgMi4wOSAtMC44Njd2MS44MmE1LjMyNSA1LjMyNSAwIDAgMSAtMi4xNzIgMC40NTVaTTE4Ljc2NSAyMC44NGMwIDEuNTMyIC0xLjI2MiAyLjU4NyAtMy4wODMgMi41ODcgLTEuMzI1IDAgLTIuMjc1IC0wLjQ1NSAtMy4wODMgLTEuNDlsMS4xMzcgLTAuOTczYzAuMzkzIDAuNzA1IDEuMDU1IDEuMDU1IDEuODgzIDEuMDU1IDAuNzg3IDAgMS4zNDUgLTAuNDc1IDEuMzQ1IC0xLjA5NSAwIC0wLjM1MiAtMC4xNjUgLTAuNjIzIC0wLjUxNyAtMC44MjhhNy4yIDcuMiAwIDAgMCAtMS4yIC0wLjQ1OGMtMS42MzMgLTAuNTE1IC0yLjE5MiAtMS4wNzUgLTIuMTkyIC0yLjE3IDAgLTEuMjg1IDEuMiAtMi4yNTggMi43NzIgLTIuMjU4IDAuOTkzIDAgMS44ODMgMC4zMTMgMi42MjcgMC44OWwtMC45MSAxLjAzNWExLjkwMyAxLjkwMyAwIDAgMCAtMS40MDcgLTAuNjJjLTAuNzQ1IDAgLTEuMjgyIDAuMzcyIC0xLjI4MiAwLjg2NyAwIDAuNDE1IDAuMzEgMC42NDMgMS4zNDUgMC45OTUgMS45ODUgMC42MiAyLjU2NSAxLjIgMi41NjUgMi40ODJ2LTAuMDIyWk0xMC4yMiAxNS4zOGgxLjczN3Y3Ljg4M2gtMS43MzdWMTUuMzhaTTQuNjM1IDIzLjI2MkgyLjA3VjE1LjM4aDIuNTY1YzIuODEzIDAgNC43NTggMS42MTMgNC43NTggMy45MyAwIDEuMTggLTAuNTc4IDIuMjk4IC0xLjU5MyAzLjA0MyAtMC44NyAwLjYyIC0xLjg0MyAwLjkxIC0zLjE4NSAwLjkxaDAuMDJabTIuMDI1IC01LjkxOGMtMC41NzUgLTAuNDU1IC0xLjI0IC0wLjYyIC0yLjM3NSAtMC42MmgtMC40Nzh2NS4yMTNoMC40NzVjMS4xMTcgMCAxLjgyIC0wLjIwOCAyLjM4IC0wLjYyIDAuNiAtMC40OTggMC45NSAtMS4yNDIgMC45NSAtMi4wMDggMCAtMC43NjUgLTAuMzUgLTEuNDkgLTAuOTUgLTEuOTY1WiIgZmlsbD0iIzAwMCIvPgogICAgPHBhdGggZD0iTTMxLjAzNSAxNS4xNzJjLTIuMjc1IDAgLTQuMTM4IDEuODIgLTQuMTM4IDQuMDc1IDAgMi40IDEuNzc3IDQuMiA0LjEzOCA0LjJhNC4xIDQuMSAwIDAgMCA0LjEzOCAtNC4xMzhjMCAtMi4zMTcgLTEuOCAtNC4xMzggLTQuMTM4IC00LjEzOFoiIGZpbGw9IiNGMjc3MTIiLz4KICA8L2c+Cjwvc3ZnPgo='/>");
    }
    else{
        //Unknown
        ui->brandsvg_label->setText("?");
    }

    if(isDigits(str, len) &&
        (sumEvenPlaces(str, len) + sumOddPlaces(str, len)) % 10 == 0 && validBrand){
        validNum = true;
    }

    if(validNum){
        ui->output_label->setStyleSheet("background-color: #57eb64; "
                                        "border-style: none; "
                                        "color: black; "
                                        "border-radius: 10px;");
        ui->output_label->setText("Valid");
    }else{
        ui->output_label->setStyleSheet("background-color: #ff2965; "
                                        "border-style: none; "
                                        "color: black; "
                                        "border-radius: 10px;");
        ui->output_label->setText("Invalid");

    }
}

// Allows user to press enter/return in the line edit field and
// acts as if the pushButton was clicked
void MainWindow::on_lineEdit_returnPressed()
{
    on_pushButton_clicked();
}

